; Progressive JPEG Decoder Test
; Tests both baseline and progressive JPEG decoding

Import "../jpeg/ProgressiveJPEGDecoder.rgr"
Import "../jpeg/PPMImage.rgr"

class ProgressiveJPEGTest {
    sfn m@(main):void () {
        print "=== Progressive JPEG Decoder Test ==="
        print ""
        
        def dirPath "c:\\Users\\terok\\proj\\Ranger\\gallery\\pdf_writer\\"
        def ppm (new PPMImage())
        
        ; Test with Example.jpg (PROGRESSIVE JPEG)
        print "Test 1: Progressive JPEG (Example.jpg)"
        print "---------------------------------------"
        def decoder1 (new ProgressiveJPEGDecoder())
        def img1:ImageBuffer (decoder1.decode(dirPath "Example.jpg"))
        print "Result: " + (to_string img1.width) + "x" + (to_string img1.height)
        ppm.save(img1 dirPath "progressive_example_output.ppm")
        print "Saved: progressive_example_output.ppm"
        print ""
        
        ; Test with Canon_40D.jpg (BASELINE JPEG)
        print "Test 2: Baseline JPEG (Canon_40D.jpg)"
        print "-------------------------------------"
        def decoder2 (new ProgressiveJPEGDecoder())
        def img2:ImageBuffer (decoder2.decode(dirPath "Canon_40D.jpg"))
        print "Result: " + (to_string img2.width) + "x" + (to_string img2.height)
        def scaled2 (img2.scale(3))
        ppm.save(scaled2 dirPath "progressive_baseline_output.ppm")
        print "Saved: progressive_baseline_output.ppm"
        print ""
        
        print "=== Test Complete ==="
    }
}
